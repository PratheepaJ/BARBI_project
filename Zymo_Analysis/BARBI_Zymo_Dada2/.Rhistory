pd$Axis.2 <- pd$Axis.2
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="") +
geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
# p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="") +
#   geom_point(size = 3) +
#   scale_color_manual(values = c("blue", col.manual[-7])) +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
#   guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.2 <- pd$Axis.2
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
pd$Axis.1
pd$Axis.1 <- pd$Axis.1 + rnorm(18,mean= 1, sd=1)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
pd$Axis.1 <- pd$Axis.1 + .6
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
# p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="") +
#   geom_point(size = 3) +
#   scale_color_manual(values = c("blue", col.manual[-7])) +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
#   guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1 <- pd$Axis.1 + .6
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3, position = "dodge") +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3, position = position_dodge(width = .1)) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3, position = position_dodge(width = .2)) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3, position = position_dodge(width = .5)) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3, position = position_dodge(width = .9)) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
# p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="") +
#   geom_point(size = 3) +
#   scale_color_manual(values = c("blue", col.manual[-7])) +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
#   guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.2,.3,.4,.5,.6,.7,.8)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3, position = position_dodge(width = .9)) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
# p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="") +
#   geom_point(size = 3) +
#   scale_color_manual(values = c("blue", col.manual[-7])) +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
#   guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.3,.4,.5,.6,.7,.8)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3, position = position_dodge(width = .9)) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
# p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="") +
#   geom_point(size = 3) +
#   scale_color_manual(values = c("blue", col.manual[-7])) +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
#   guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.1,.4,.5,.6,.7,.8)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.15,.4,.5,.6,.7,.8)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.15,.1,.5,.6,.7,.8)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.15,.1,.1,.1,.1,.1)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.15,.12,.13,.15,.11,.14)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.15,.12,.2,.2,.2,.2)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.15,.1,.2,.2,.2,.2)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.15,.16,.2,.2,.2,.2)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.15,.16,.18,.2,.2,.2)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.1,.1,.15,.16,.18,0,0,0)
pd$Axis.2[8:10] <- pd$Axis.2[8:10] + c(.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.08,.08,.15,.16,.18,0,0,0)
pd$Axis.2[8:10] <- pd$Axis.2[8:10] + c(.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.15,.16,.18,0,0,0)
pd$Axis.2[8:10] <- pd$Axis.2[8:10] + c(.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.05,.16,.18,0,0,0)
pd$Axis.2[8:10] <- pd$Axis.2[8:10] + c(.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.07,.16,.18,0,0,0)
pd$Axis.2[8:10] <- pd$Axis.2[8:10] + c(.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.07,.16,.18,0,0,0)
pd$Axis.2[c(3,8:10)] <- pd$Axis.2[c(3,8:10)] + c(.01,.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.07,.16,.18,0,0,0)
pd$Axis.2[c(3,8:10)] <- pd$Axis.2[c(3,8:10)] + c(.02,.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.07,.1,.1,0,0,0)
pd$Axis.2[c(3,8:10)] <- pd$Axis.2[c(3,8:10)] + c(.02,.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.07,.12,.1,0,0,0)
pd$Axis.2[c(3,8:10)] <- pd$Axis.2[c(3,8:10)] + c(.02,.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
ps.prop <- transform_sample_counts(ps, function(otu) otu/sum(otu))
ord.mds.bray <- ordinate(ps.prop, method="MDS", distance="bray")
evals <- ord.mds.bray$values$Eigenvalues
# p <- plot_ordination(ps.prop, ord.mds.bray, color="SampleType", title="Bray MDS")+
#   geom_text(aes(label = Name), size = 4, hjust = 1) +
#   theme_bw() +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5))
#
name.label <- c("Negative Control","Negative Control","Standard 1:1","Standard 1:6","Standard 1:(6^2)","Standard 1:(6^3)","Standard 1:(6^4)","Standard 1:(6^5)","Standard 1:(6^6)", "Standard 1:(6^7)",as.character(rep("Negative Control",8)))
sample_data(ps.prop)$name.label <- name.label
sample_data(ps.prop)$name.label <- factor(sample_data(ps.prop)$name.label, levels = c("Negative Control","Standard 1:1","Standard 1:6","Standard 1:(6^2)" ,"Standard 1:(6^3)" ,"Standard 1:(6^4)", "Standard 1:(6^5)" ,"Standard 1:(6^6)","Standard 1:(6^7)"))
col.manual <- rainbow(9)
#blue "#0040FFFF"
levels(sample_data(ps.prop)$SampleType) <- c("Negative Control", "Sandard")
# p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="") +
#   geom_point(size = 3) +
#   scale_color_manual(values = c("blue", col.manual[-7])) +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
#   guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.07,.12,.1,0,0,0)
pd$Axis.2[c(3,8:10)] <- pd$Axis.2[c(3,8:10)] + c(.02,.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
ggsave("./Figures/Zymo_MDS_BC.eps", plot=p, width = 8, height = 4)
ps.prop <- transform_sample_counts(ps, function(otu) otu/sum(otu))
ord.mds.bray <- ordinate(ps.prop, method="MDS", distance="bray")
evals <- ord.mds.bray$values$Eigenvalues
# p <- plot_ordination(ps.prop, ord.mds.bray, color="SampleType", title="Bray MDS")+
#   geom_text(aes(label = Name), size = 4, hjust = 1) +
#   theme_bw() +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5))
#
name.label <- c("Negative Control","Negative Control","Standard 1:1","Standard 1:6","Standard 1:(6^2)","Standard 1:(6^3)","Standard 1:(6^4)","Standard 1:(6^5)","Standard 1:(6^6)", "Standard 1:(6^7)",as.character(rep("Negative Control",8)))
sample_data(ps.prop)$name.label <- name.label
sample_data(ps.prop)$name.label <- factor(sample_data(ps.prop)$name.label, levels = c("Negative Control","Standard 1:1","Standard 1:6","Standard 1:(6^2)" ,"Standard 1:(6^3)" ,"Standard 1:(6^4)", "Standard 1:(6^5)" ,"Standard 1:(6^6)","Standard 1:(6^7)"))
col.manual <- rainbow(9)
#blue "#0040FFFF"
levels(sample_data(ps.prop)$SampleType) <- c("Negative Control", "Sandard")
# p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="") +
#   geom_point(size = 3) +
#   scale_color_manual(values = c("blue", col.manual[-7])) +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
#   guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.07,.12,.1,0,0,0)
pd$Axis.2[c(3,8:10)] <- pd$Axis.2[c(3,8:10)] + c(.02,.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p
ggsave("./Figures/Zymo_MDS_BC.eps", plot=p, width = 8, height = 4)
evals[1]/sum(evals)
evals[1]/sum(evals)*100
round(evals[1]/sum(evals)*100,digits = 1)
ps.prop <- transform_sample_counts(ps, function(otu) otu/sum(otu))
ord.mds.bray <- ordinate(ps.prop, method="MDS", distance="bray")
evals <- ord.mds.bray$values$Eigenvalues
# p <- plot_ordination(ps.prop, ord.mds.bray, color="SampleType", title="Bray MDS")+
#   geom_text(aes(label = Name), size = 4, hjust = 1) +
#   theme_bw() +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5))
#
name.label <- c("Negative Control","Negative Control","Standard 1:1","Standard 1:6","Standard 1:(6^2)","Standard 1:(6^3)","Standard 1:(6^4)","Standard 1:(6^5)","Standard 1:(6^6)", "Standard 1:(6^7)",as.character(rep("Negative Control",8)))
sample_data(ps.prop)$name.label <- name.label
sample_data(ps.prop)$name.label <- factor(sample_data(ps.prop)$name.label, levels = c("Negative Control","Standard 1:1","Standard 1:6","Standard 1:(6^2)" ,"Standard 1:(6^3)" ,"Standard 1:(6^4)", "Standard 1:(6^5)" ,"Standard 1:(6^6)","Standard 1:(6^7)"))
col.manual <- rainbow(9)
#blue "#0040FFFF"
levels(sample_data(ps.prop)$SampleType) <- c("Negative Control", "Sandard")
# p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="") +
#   geom_point(size = 3) +
#   scale_color_manual(values = c("blue", col.manual[-7])) +
#   coord_fixed(sqrt(evals[2] / evals[1])) +
#   theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
#   guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE)
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.07,.12,.1,0,0,0)
pd$Axis.2[c(3,8:10)] <- pd$Axis.2[c(3,8:10)] + c(.02,.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE) + xlab(paste0("Axis.1",round(evals[1]/sum(evals)*100,digits = 1),"%"))
p
ggsave("./Figures/Zymo_MDS_BC.eps", plot=p, width = 8, height = 4)
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.07,.12,.1,0,0,0)
pd$Axis.2[c(3,8:10)] <- pd$Axis.2[c(3,8:10)] + c(.02,.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE) + xlab(paste0("Axis.1","[",round(evals[1]/sum(evals)*100,digits = 1),"%","]"))
p
p <- plot_ordination(ps.prop, ord.mds.bray, color="name.label",  title="")
pd <- p$data
pd$Axis.1[3:10] <- pd$Axis.1[3:10] + c(.05,.05,.07,.12,.1,0,0,0)
pd$Axis.2[c(3,8:10)] <- pd$Axis.2[c(3,8:10)] + c(.02,.02,.03,.04)
p <- ggplot(data= pd, aes(x= Axis.1, y = Axis.2, color = name.label)) + geom_point(size = 3) +
scale_color_manual(values = c("blue", col.manual[-7])) +
coord_fixed(sqrt(evals[2] / evals[1])) +
theme(plot.title = element_text(hjust = 0.5), legend.title=element_text(size = 8), legend.text=element_text(size=8)) +
guides(color = guide_legend(title="Sample")) + scale_shape_discrete(guide = FALSE) + xlab(paste0("Axis.1","[",round(evals[1]/sum(evals)*100,digits = 1),"%","]")) + ylab(paste0("Axis.2","[",round(evals[2]/sum(evals)*100,digits = 1),"%","]"))
p
ggsave("./Figures/Zymo_MDS_BC.eps", plot=p, width = 8, height = 4)
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, fig.width = 18, fig.height = 12)
#library(BARBI)
library(devtools)
library(phyloseq)
library(DESeq2)
library(dplyr)
library(tidyr)
library(R.utils)
library(BiocParallel)
library(doParallel)
library(parallel)
library(HDInterval)
library(grid)
library(xtable)
library(gtable)
library(gridExtra)
library(BiocStyle)
library(magrittr)
library(ggplot2)
sourceDirectory("./R")
set.theme <- theme_update(panel.border = element_blank(),
panel.grid = element_line(size = .8),
axis.ticks = element_blank(),
legend.title = element_text(size = 8),
legend.text = element_text(size = 8),
axis.text = element_text(size = 8),
axis.title = element_text(size = 8),
strip.background = element_blank(),
strip.text = element_text(size = 8),
legend.key = element_blank(),
plot.title = element_text(hjust = 0.5))
theme_set(theme_bw())
ncores <- as.integer(Sys.getenv("SLURM_NTASKS"))
if(is.na(ncores)) ncores <- parallel::detectCores()
ps <- readRDS("./Data/ps_zymo.rds")
if(dim(otu_table(ps))[1]!=ntaxa(ps)){otu_table(ps) <- t(otu_table(ps))}
ncont <- paste0("NegativeControl.",seq(1,10))
stan <- paste0("Standard.Dilution.1.",c(1,6,36,216,1296,7776,46656,279936))
#stan <- c(paste0("Standard.Dilution.1.",c(1,6,36,216,1296,7776,46656)),"StandardDilution.1.279936")
sample_data(ps)$Name <- factor(sample_data(ps)$Name, levels = c(ncont,stan))
sample_names(ps) <- as.character(sample_data(ps)$Name)
ASV <- as.character(paste0("ASV_",seq(1,ntaxa(ps))))
ASV.Genus <- paste0("ASV_",seq(1,ntaxa(ps)),"_",as.character(tax_table(ps)[,6]))
ASV.Genus.Species <- paste0(ASV,"_",as.character(tax_table(ps)[,6]),"_", as.character(tax_table(ps)[,7]))
df.ASV <- data.frame(seq.variant = taxa_names(ps), ASV = ASV, ASV.Genus = ASV.Genus, ASV.Genus.Species = ASV.Genus.Species)
taxa_names(ps) <- df.ASV$ASV.Genus.Species
library(ggrepel)
ps.alpha <- ps
Pi <- c(18.58,2.03,14.91,.29,13.68,11.28,14.59,1.46,8.43,10.33,4.42)
Pi <- Pi/100
true.shannon.index <- sum((Pi * log(Pi))*(-1))
true.shannon.index
Pi <- c(18.58,2.03,14.91,.29,13.68,11.28,14.59,1.46,8.43,10.33,4.42)
PiPiminus1 <- Pi*(Pi-1)
NNminus1 <- 100*(100-1)
D <- sum(PiPiminus1)/NNminus1
D
name.label <- c("","","1:1","1:6","1:(6^2)","1:(6^3)","1:(6^4)","1:(6^5)","1:(6^6)", "1:(6^7)",as.character(rep("",8)))
sample_data(ps.alpha)$name.label <- name.label
sample_data(ps.alpha)$name.label <- factor(sample_data(ps.alpha)$name.label)
name.color <- c("Negative Control","Negative Control","1:1","1:6","1:6^2","1:6^3","1:6^4","1:6^5","1:6^6", "1:6^7",as.character(rep("Negative Control",8)))
sample_data(ps.alpha)$name.color <- name.color
sample_data(ps.alpha)$name.color <- factor(sample_data(ps.alpha)$name.color)
# p <- plot_richness(ps.alpha, x="SampleType", measures = c("Shannon"), color = "name.color") + geom_text(aes(label = name.label), size = 4, hjust = -0.2) + ylab("Shannon Index") + expand_limits(y = c(2, 3.5)) + xlab("Sample Type") + theme(axis.text.x=element_blank(), strip.text.x = element_blank())
levels(sample_data(ps.alpha)$SampleType) <- c("Negative Control", "Dilution")
# p <- plot_richness(ps.alpha, x="SampleType", measures = c("Shannon"), color = "SampleType") + ylab("Shannon Index") + scale_color_manual(values = c("blue", "brown"))+
#   expand_limits(y = c(2, 3.5)) +
#   xlab("Sample Type") +
#   geom_text_repel(aes(label = name.label), size = 4, direction = "x") +
#   theme(strip.text.x = element_blank(), axis.text.x = element_text(angle = -360), legend.position = "none") + geom_hline (yintercept= true.shannon.index, colour="red", lty=6, lwd=1)
col.manual <- rainbow(9)
p <- plot_richness(ps.alpha, x="SampleType", measures = c("Shannon"), color = "name.label") +
geom_point(size = 3) +
ylab("Shannon Index") +
scale_color_manual(values = c("blue", col.manual[-7]))  +
xlab("Sample Type") +
geom_text_repel(aes(label = name.label), size = 4, direction = "x") +
theme(strip.text.x = element_blank(), legend.position = "none", axis.text.x = element_text(angle = -360)) + geom_hline (yintercept= true.shannon.index, colour="red", lty=6, lwd=1)
p
ggsave("./Figures/Zymo_alpha_diversity.eps", plot=p, width = 4, height = 6)
ps.top <- ps
ot <- otu_table(ps.top) %>% data.frame %>% as.matrix
geo_mean <- function(x) {
if(all(x == 0)){
val <- 0
}else{
val <- exp(sum(log(x[x > 0]))/length(x))
}
return(val)
}
geom_mean_row <- apply(ot, 1, FUN = geo_mean)
sj <- estimateSizeFactorsForMatrix(ot, median, geoMeans = geom_mean_row)
ot.trans <- t(asinh(t(ot)/sj))
ps.top <- phyloseq(otu_table(ot.trans, taxa_are_rows = TRUE), sample_data(ps.top), tax_table(ps.top))
top <- names(sort(taxa_sums(ps.top), decreasing=TRUE))[1:30]
ps.top <- prune_taxa(top, ps.top)
otu_table(ps.top) <- otu_table(ps.top) +1
p <- plot_heatmap(ps.top, sample.label = "Name", taxa.label="Genus", sample.order = c(ncont,stan)) + geom_tile()
p <- p +
guides(fill = guide_legend(title="asinh abundance")) + xlab("Sample")
p
ggsave("./Figures/heatmap_top.eps", plot = p, width = 10, height = 8, dpi = 300)
